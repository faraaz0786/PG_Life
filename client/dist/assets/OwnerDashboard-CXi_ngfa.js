import{b as k,$ as w,r as q,x as j,a0 as p,j as e,L as r,h as g,B as L,Z as A,a1 as b,I as z,k as C,a2 as S,a3 as F,v as P,X as _,z as h}from"./vendor-sH-yV7sT.js";import{u as D}from"./index-CUPUJmJk.js";import{d as E,m as R}from"./listings-DZrZQjYm.js";import{u as M,o as $}from"./bookings-BF9ojx4j.js";function m({icon:a,label:i,value:d}){return e.jsxs("div",{className:"card p-5 flex items-center gap-3",children:[e.jsx("div",{className:"h-11 w-11 rounded-xl bg-indigo-600/10 text-indigo-700 dark:text-indigo-300 grid place-items-center",children:e.jsx(a,{size:20})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[22px] font-extrabold leading-6",children:d}),e.jsx("div",{className:"text-[12px] text-slate-500 dark:text-slate-400",children:i})]})]})}function B({status:a}){const i="badge capitalize";return a==="accepted"?e.jsx("span",{className:`${i} !bg-green-100 !text-green-700 dark:!bg-green-900/40 dark:!text-green-300`,children:"accepted"}):a==="declined"?e.jsx("span",{className:`${i} !bg-rose-100 !text-rose-700 dark:!bg-rose-900/40 dark:!text-rose-300`,children:"declined"}):e.jsx("span",{className:`${i} !bg-amber-100 !text-amber-700 dark:!bg-amber-900/40 dark:!text-amber-300`,children:"requested"})}function G(){const{user:a}=D()||{},i=k(),d=w();q.useEffect(()=>{a!==void 0&&(a?a.role!=="owner"&&i("/dashboard",{replace:!0}):i("/login",{replace:!0}))},[a,i]);const{data:c=[],isFetching:N}=j({enabled:!!a&&a.role==="owner",queryKey:["listings","mine",a==null?void 0:a.id],queryFn:R}),{data:n=[],isFetching:v}=j({enabled:!!a&&a.role==="owner",queryKey:["bookings","owner",a==null?void 0:a.id],queryFn:$}),u=p({mutationFn:s=>E(s),onSuccess:()=>{h.success("Listing deleted"),d.invalidateQueries({queryKey:["listings","mine"]}),d.invalidateQueries({queryKey:["bookings","owner"]})},onError:s=>{var t,l;return h.error(((l=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:l.message)||"Failed to delete")}}),o=p({mutationFn:({id:s,status:t})=>M(s,t),onSuccess:()=>d.invalidateQueries({queryKey:["bookings","owner"]}),onError:s=>{var t,l;return h.error(((l=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:l.message)||"Update failed")}}),x=Array.isArray(c)?c.length:0,f=(Array.isArray(n)?n:[]).filter(s=>s.status==="requested"),y=(Array.isArray(n)?n:[]).filter(s=>s.status==="accepted");return e.jsxs("div",{className:"container-max section space-y-8",children:[e.jsxs("div",{className:"card p-6 md:p-8 relative overflow-hidden",children:[e.jsx("div",{className:"absolute -top-24 -right-24 h-64 w-64 rounded-full bg-indigo-500/20 blur-3xl"}),e.jsx("div",{className:"absolute -bottom-24 -left-24 h-64 w-64 rounded-full bg-cyan-500/10 blur-3xl"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"text-xs uppercase tracking-wider text-indigo-600 dark:text-indigo-300 font-semibold",children:["Welcome",a!=null&&a.name?`, ${a.name.split(" ")[0]}`:""," ðŸ‘‹"]}),e.jsx("h1",{className:"text-2xl md:text-3xl font-extrabold tracking-tight",children:"Owner Console"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300 mt-1",children:"Manage your listings and handle booking requests seamlessly."}),e.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[e.jsxs(r,{to:"/owner",className:"btn btn-primary",children:[e.jsx(g,{size:16})," Add Listing"]}),e.jsx(r,{to:"/search",className:"btn",children:"Preview marketplace"})]})]})]}),e.jsxs("div",{className:"grid sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(m,{icon:L,label:"Total Listings",value:x}),e.jsx(m,{icon:A,label:"Requests (Pending)",value:f.length}),e.jsx(m,{icon:b,label:"Requests (Accepted)",value:y.length}),e.jsx(m,{icon:z,label:"Avg. Price",value:x?Math.round(c.reduce((s,t)=>s+(t.price||0),0)/x).toLocaleString("en-IN"):0})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold",children:"Your Listings"}),e.jsxs(r,{to:"/owner",className:"btn",children:[e.jsx(g,{size:16})," Add Listing"]})]}),N?e.jsx("div",{className:"grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:Array.from({length:8}).map((s,t)=>e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"skeleton h-36 w-full mb-3"}),e.jsx("div",{className:"skeleton h-4 w-2/3 mb-2"}),e.jsx("div",{className:"skeleton h-3 w-1/2"})]},t))}):x===0?e.jsxs("div",{className:"card p-8 text-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"No listings yet"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300 mt-1",children:"Add your first PG to start receiving requests."}),e.jsxs(r,{to:"/owner",className:"btn btn-primary mt-4",children:[e.jsx(g,{size:16})," Add Listing"]})]}):e.jsx("div",{className:"grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:c.map(s=>{var t;return e.jsxs("div",{className:"card overflow-hidden group",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:((t=s.images)==null?void 0:t[0])||"https://images.unsplash.com/photo-1505691723518-36a5ac3b2aa5?q=80&w=1600&auto=format&fit=crop",alt:s.title,className:"h-36 w-full object-cover transition-transform duration-300 group-hover:scale-[1.03]",loading:"lazy",decoding:"async"}),e.jsxs("div",{className:"price-badge",children:["â‚¹",(s.price??0).toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"p-4 space-y-1",children:[e.jsx("div",{className:"font-semibold line-clamp-1",children:s.title}),e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 flex items-center gap-1",children:[e.jsx(C,{size:14}),s.city]}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsxs(r,{to:`/listing/${s._id}`,className:"btn",children:[e.jsx(S,{size:16})," View"]}),e.jsxs(r,{to:"/owner",className:"btn",children:[e.jsx(F,{size:16})," Edit"]}),e.jsxs("button",{className:"btn btn-ghost",onClick:()=>{confirm("Delete this listing? This cannot be undone.")&&u.mutate(s._id)},disabled:u.isLoading,title:"Delete listing",children:[e.jsx(P,{size:16})," Delete"]})]})]})]},s._id)})})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold",children:"Booking Requests"}),v?e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:Array.from({length:6}).map((s,t)=>e.jsxs("div",{className:"card p-4",children:[e.jsx("div",{className:"skeleton h-4 w-1/2 mb-2"}),e.jsx("div",{className:"skeleton h-3 w-1/3 mb-3"}),e.jsx("div",{className:"skeleton h-8 w-32"})]},t))}):(n||[]).length===0?e.jsx("div",{className:"card p-6 text-sm text-slate-600 dark:text-slate-300",children:"No requests yet."}):e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:n.map(s=>{var t,l;return e.jsxs("div",{className:"card p-4 flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:((t=s.listing)==null?void 0:t.title)||"PG"}),e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:[((l=s.seeker)==null?void 0:l.name)||"Seeker"," â€¢ ",new Date(s.createdAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{status:s.status}),s.status==="requested"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn",onClick:()=>o.mutate({id:s._id,status:"accepted"}),disabled:o.isLoading,children:[e.jsx(b,{size:16})," Accept"]}),e.jsxs("button",{className:"btn btn-ghost",onClick:()=>o.mutate({id:s._id,status:"declined"}),disabled:o.isLoading,children:[e.jsx(_,{size:16})," Decline"]})]})]})]},s._id)})})]})]})}export{G as default};
