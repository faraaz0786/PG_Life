import{D as R,x as v,r as n,j as e,I as z,E as C,k as I,J as q,z as l}from"./vendor-sH-yV7sT.js";import{g as A}from"./listings-DZrZQjYm.js";import{a as j,u as S}from"./index-CUPUJmJk.js";import{a as E}from"./favorites-DJNQdwZb.js";import{c as B}from"./bookings-BF9ojx4j.js";const L=i=>j.post("/api/reviews",i).then(c=>c.data),P=i=>j.get(`/api/reviews/${i}`).then(c=>c.data);function J(){var h;const{id:i}=R(),{user:c}=S(),{data:t,isFetching:u,isError:N}=v({queryKey:["listing",i],queryFn:()=>A(i)}),{data:d,refetch:f}=v({queryKey:["reviews",i],queryFn:()=>P(i)}),[o,y]=n.useState(5),[m,x]=n.useState(""),[p,b]=n.useState(0),w=async()=>{var s,a;try{await E(i),l.success("Added to favorites")}catch(r){l.error(((a=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to add to favorites")}},k=async()=>{var s,a;try{await B({listingId:i}),l.success("Booking requested")}catch(r){l.error(((a=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to create booking")}},F=async()=>{var s,a;try{await L({listingId:i,rating:o,comment:m}),x(""),l.success("Review posted"),await f()}catch(r){l.error(((a=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to post review")}};if(u)return e.jsx("div",{className:"container-max py-6",children:"Loading..."});if(N||!t)return e.jsx("div",{className:"container-max py-6 text-red-600",children:"Failed to load listing."});const g=(h=t.images)!=null&&h.length?t.images:["https://picsum.photos/seed/placeholder/800/500"];return e.jsxs("div",{className:"container-max section space-y-6",children:[e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-3",children:[e.jsx("div",{className:"card overflow-hidden",children:e.jsx("img",{src:g[p],className:"w-full h-96 object-cover"})}),e.jsx("div",{className:"grid grid-cols-4 gap-3",children:g.slice(0,8).map((s,a)=>e.jsx("button",{className:`card overflow-hidden ${a===p?"ring-2 ring-brand-500":""}`,onClick:()=>b(a),children:e.jsx("img",{src:s,className:"h-24 w-full object-cover"})},a))})]}),e.jsx("aside",{className:"lg:col-span-1",children:e.jsxs("div",{className:"card p-4 sticky top-24 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-2xl font-semibold flex items-center gap-1",children:[e.jsx(z,{size:20})," ",t.price]}),e.jsxs("div",{className:"badge flex items-center gap-1",children:[e.jsx(C,{size:14})," ",Number(t.ratingAvg||0).toFixed(1)," (",t.ratingCount||0,")"]})]}),e.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-300 flex items-center gap-2",children:[e.jsx(I,{size:16})," ",t.city," · ",t.address]}),e.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-300 flex items-center gap-2",children:[e.jsx(q,{size:16})," Gender policy: ",e.jsx("b",{className:"capitalize",children:t.genderPolicy})]}),(c==null?void 0:c.role)==="seeker"&&e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{className:"btn flex-1",onClick:w,children:"Add to Favorites"}),e.jsx("button",{className:"btn btn-primary flex-1",onClick:k,children:"Request Booking"})]})]})})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"md:col-span-2 card p-4 space-y-3",children:[e.jsx("h1",{className:"text-2xl font-bold",children:t.title}),e.jsx("p",{className:"text-slate-700 dark:text-slate-200/90",children:t.description}),e.jsx("div",{className:"flex flex-wrap gap-2 pt-2",children:(t.amenities||[]).map(s=>e.jsx("span",{className:"badge capitalize",children:s.replaceAll("_"," ")},s))})]}),e.jsxs("div",{className:"card p-4 space-y-3",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Reviews"}),e.jsxs("div",{className:"space-y-3 max-h-80 overflow-auto pr-2",children:[(d||[]).map(s=>{var a;return e.jsxs("div",{className:"border-b border-slate-200 dark:border-slate-800 pb-3",children:[e.jsxs("div",{className:"font-medium",children:[((a=s.seekerId)==null?void 0:a.name)||"User"," · ",s.rating,"★"]}),e.jsx("p",{className:"text-sm text-slate-700 dark:text-slate-300",children:s.comment})]},s._id)}),(d||[]).length===0&&e.jsx("div",{className:"text-sm text-slate-500",children:"No reviews yet."})]}),(c==null?void 0:c.role)==="seeker"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm",children:"Rating"}),e.jsx("input",{className:"input w-24",type:"number",min:"1",max:"5",value:o,onChange:s=>y(Number(s.target.value))})]}),e.jsx("textarea",{className:"textarea",rows:"3",placeholder:"Write a review...",value:m,onChange:s=>x(s.target.value)}),e.jsx("button",{className:"btn btn-primary w-full",onClick:F,children:"Submit Review"})]})]})]})]})}export{J as default};
